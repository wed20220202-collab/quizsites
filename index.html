<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¯ã‚¤ã‚ºã‚µã‚¤ãƒˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #111;
  color: #fff;
  padding: 20px;
}

select, input[type="file"], button {
  padding: 8px;
  font-size: 16px;
  margin: 5px 5px 10px 0;
}

.quiz {
  display: flex;
  gap: 20px;
  margin: 12px 0;
  padding: 10px;
  border-bottom: 1px solid #333;
}

.question { width: 60%; }
.answer { width: 40%; }

.correct {
  color: #4caf50;
  font-weight: bold;
}

.wrong {
  color: #f44336;
  font-weight: bold;
}

#result {
  margin-top: 20px;
  font-size: 18px;
}
</style>
</head>

<body>

<h2>ğŸ“˜ ã‚¯ã‚¤ã‚º</h2>

<label>å‡ºé¡Œæ•°ï¼š</label>
<select id="questionCount">
  <option value="10">10å•</option>
  <option value="20">20å•</option>
  <option value="30">30å•</option>
  <option value="50">50å•</option>
</select>

<input type="file" id="excel" accept=".xlsx">
<button onclick="startQuiz()">é–‹å§‹</button>
<button onclick="checkAnswers()">ç­”ãˆåˆã‚ã›</button>

<hr>

<div id="quiz-area"></div>
<div id="result"></div>

<script>
// ===============================
// å›ºå®šé¸æŠè‚¢ï¼ˆé‡è¤‡é™¤å¤–æ¸ˆï¼‰
// ===============================
const CHOICES = [
  "C010","C011","C020","C030","C040","C041","C060","C070","C080","C081",
  "C090","C100","C110","C113","C114","C115","C116","C118","C119","C120",
  "C121","C122","C123","C124","C126","C128","C129","C130","C131","C132",
  "C133","C134","C135","C136","C137","C138","C140","C141","C142","C143",
  "C144","C145","C146","C147","C148","C149","C150","C160","C170","C190",
  "C200","C210","C211","C220","C221","C222","C230","C231","C232","C233",
  "C234","C235","C236","C240","C241","C250","C261","C271","C272","C273",
  "C274","C275","C277","C278","C280","C281","C282","C283","C284","C290",
  "C330","C340","C370","C400","C401","C430","C440",
  "C12A","C12B",
  "C13A","C13B","C13C","C13D","C13E","C13F","C13H","C13I","C13J",
  "C14A"
];

// Excelã‹ã‚‰èª­ã¿è¾¼ã‚“ã å…¨å•é¡Œ
let allQuestions = [];
let currentQuestions = [];

// Excelèª­ã¿è¾¼ã¿
document.getElementById("excel").addEventListener("change", function (e) {
  const file = e.target.files[0];
  const reader = new FileReader();

  reader.onload = function (e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: "array" });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

    // Aåˆ—: å•é¡Œæ–‡, Båˆ—: æ­£è§£
    allQuestions = rows.filter(r => r[0] && r[1]);
    alert(`å•é¡Œã‚’ ${allQuestions.length} å•èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
  };

  reader.readAsArrayBuffer(file);
});

// ã‚¯ã‚¤ã‚ºé–‹å§‹
function startQuiz() {
  if (allQuestions.length === 0) {
    alert("å…ˆã«Excelã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„");
    return;
  }

  const count = Number(document.getElementById("questionCount").value);
  currentQuestions = shuffle([...allQuestions]).slice(0, count);

  const quizArea = document.getElementById("quiz-area");
  quizArea.innerHTML = "";
  document.getElementById("result").innerHTML = "";

  currentQuestions.forEach((row, index) => {
    const question = row[0];

    const div = document.createElement("div");
    div.className = "quiz";
    div.dataset.answer = row[1];

    div.innerHTML = `
      <div class="question">
        Q${index + 1}. ${question}
      </div>
      <div class="answer">
        <select>
          <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
          ${CHOICES.map(c => `<option value="${c}">${c}</option>`).join("")}
        </select>
        <div class="judge"></div>
      </div>
    `;

    quizArea.appendChild(div);
  });
}

// ç­”ãˆåˆã‚ã›
function checkAnswers() {
  let correct = 0;
  const quizzes = document.querySelectorAll(".quiz");

  quizzes.forEach(q => {
    const correctAnswer = q.dataset.answer;
    const selected = q.querySelector("select").value;
    const judge = q.querySelector(".judge");

    if (!selected) {
      judge.textContent = "æœªå›ç­”";
      judge.className = "judge wrong";
      return;
    }

    if (selected === correctAnswer) {
      correct++;
      judge.textContent = "æ­£è§£";
      judge.className = "judge correct";
    } else {
      judge.textContent = `ä¸æ­£è§£ï¼ˆæ­£è§£ï¼š${correctAnswer}ï¼‰`;
      judge.className = "judge wrong";
    }
  });

  document.getElementById("result").textContent =
    `çµæœï¼š${correct} / ${quizzes.length} å• æ­£è§£`;
}

// ã‚·ãƒ£ãƒƒãƒ•ãƒ«
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}
</script>

</body>
</html>
